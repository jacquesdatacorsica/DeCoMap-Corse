<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Pierre-Henri Morand" />


<title>Live from BOAMP</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="site_libs/datatables-binding-0.17/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<script src="site_libs/jszip-1.10.20/jszip.min.js"></script>
<script src="site_libs/pdfmake-1.10.20/pdfmake.js"></script>
<script src="site_libs/pdfmake-1.10.20/vfs_fonts.js"></script>
<link href="site_libs/dt-ext-buttons-1.10.20/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="site_libs/dt-ext-buttons-1.10.20/js/dataTables.buttons.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.10.20/js/buttons.flash.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.10.20/js/buttons.html5.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.10.20/js/buttons.colVis.min.js"></script>
<script src="site_libs/dt-ext-buttons-1.10.20/js/buttons.print.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DeCoMaP</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Journal.html">Journal</a>
</li>
<li>
  <a href="live_from_DECP.html">live from D.E.C.P.</a>
</li>
<li>
  <a href="live_from_TED.html">Live from T.E.D.</a>
</li>
<li>
  <a href="live_from_BOAMP.html">Live from B.O.A.M.P.</a>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Live from BOAMP</h1>
<h4 class="author">Pierre-Henri Morand</h4>
<h4 class="date">date: 2021-05-04</h4>

</div>


<div id="présentation-de-la-base-de-donnée" class="section level1">
<h1>Présentation de la base de donnée</h1>
<p>Contrairement à la base TED, structurée par les services de l’UE en un fichier CSV unique, les données BOAMP prennent la forme de fichiers (XML ou JSON) propre à chaque avis déposé au Bulletin Officiel des Annonces des Marchés Publics. Un avis d’attribution correspond à un fichier. Ce qui signifie que chaque fichier correspond potentiellement à plusieurs lots, qui auront pour tout ou partie été attribués, chaque lot pouvant de surcroît être attribué à plus d’une entreprise.</p>
<p>Le code source nécessaire à l’obtention de notre base est disponible <a href="https://github.com/phmorand/DeCoMaP">ici</a>.</p>
<pre class="r"><code>library(tidyverse)
library(banR)
library(jsonlite)
library(magrittr)
library(data.tree)
library(geosphere)
library(sf)
library(cartography)
library(stringr)
library(httr)
library(dplyr)
library(stringr)
library(DT)

#creating the data repository
data_dir &lt;- &#39;data&#39;
if (!dir.exists(data_dir)) {
  dir.create(data_dir)
}

BOAMP_destfile &lt;-  str_c(data_dir, &quot;/BOAMP_df.Rda&quot;)
if (!file.exists(BOAMP_destfile)) {

#============================================
#==== First, GET the web id =================
#============================================

#================ useful for criterion request ===================
space = &quot;%20&quot; # 1 space
slash.sign = &quot;%2F&quot; # /
equal.sign = &quot;%3D&quot; # =
greater.than.sign = &quot;%3E&quot; # &gt;
less.than.sign = &quot;%3C&quot; # &lt;
greater.than.or.equal.to.sign = paste0(greater.than.sign,equal.sign) # &gt;=
less.than.or.equal.to.sign = paste0(less.than.sign,equal.sign) # &lt;=
# ==============================================

url_start=&quot;http://api.dila.fr/opendata/api-boamp/annonces/search&quot;

# ========== Define timelaps ===================
periods=c(&quot;01-01&quot;,&quot;05-01&quot;,&quot;09-01&quot;,&quot;13-01&quot;,&quot;17-01&quot;,&quot;21-01&quot;,&quot;25-01&quot;,&quot;28-01&quot;,
          &quot;01-02&quot;,&quot;05-02&quot;,&quot;09-02&quot;,&quot;13-02&quot;,&quot;17-02&quot;,&quot;21-02&quot;,&quot;25-02&quot;,&quot;28-02&quot;,
          &quot;01-03&quot;,&quot;05-03&quot;,&quot;09-03&quot;,&quot;13-03&quot;,&quot;17-03&quot;,&quot;21-03&quot;,&quot;25-03&quot;,&quot;28-03&quot;,
          &quot;01-04&quot;,&quot;05-04&quot;,&quot;09-04&quot;,&quot;13-04&quot;,&quot;17-04&quot;,&quot;21-04&quot;,&quot;25-04&quot;,&quot;28-04&quot;,
          &quot;01-05&quot;,&quot;05-05&quot;,&quot;09-05&quot;,&quot;13-05&quot;,&quot;17-05&quot;,&quot;21-05&quot;,&quot;25-05&quot;,&quot;28-05&quot;,
          &quot;01-06&quot;,&quot;05-06&quot;,&quot;09-06&quot;,&quot;13-06&quot;,&quot;17-06&quot;,&quot;21-06&quot;,&quot;25-06&quot;,&quot;28-06&quot;,
          &quot;01-07&quot;,&quot;05-07&quot;,&quot;09-07&quot;,&quot;13-07&quot;,&quot;17-07&quot;,&quot;21-07&quot;,&quot;25-07&quot;,&quot;28-07&quot;,
          &quot;01-08&quot;,&quot;05-08&quot;,&quot;09-08&quot;,&quot;13-08&quot;,&quot;17-08&quot;,&quot;21-08&quot;,&quot;25-08&quot;,&quot;28-08&quot;,
          &quot;01-09&quot;,&quot;05-09&quot;,&quot;09-09&quot;,&quot;13-09&quot;,&quot;17-09&quot;,&quot;21-09&quot;,&quot;25-09&quot;,&quot;28-09&quot;,
          &quot;01-10&quot;,&quot;05-10&quot;,&quot;09-10&quot;,&quot;13-10&quot;,&quot;17-10&quot;,&quot;21-10&quot;,&quot;25-10&quot;,&quot;28-10&quot;,
          &quot;01-11&quot;,&quot;05-11&quot;,&quot;09-11&quot;,&quot;13-11&quot;,&quot;17-11&quot;,&quot;21-11&quot;,&quot;25-11&quot;,&quot;28-11&quot;,
          &quot;01-12&quot;,&quot;05-12&quot;,&quot;09-12&quot;,&quot;13-12&quot;,&quot;17-12&quot;,&quot;21-12&quot;,&quot;25-12&quot;,&quot;28-12&quot;,&quot;31-12&quot;)
# ============== GET Function ====================
get_webid&lt;-function(day_start, month_start, day_stop, month_stop){fromJSON(rawToChar(httr::GET(paste0(url_start, 
                                                                                                      &quot;?criterion=&quot;,
                                                                                                      &quot;nature_cat&quot;, equal.sign, &quot;attribution&quot;,
                                                                                                      space, &quot;AND&quot;, space,
                                                                                                      &quot;dateparution&quot;, greater.than.or.equal.to.sign, &quot;2020&quot;, slash.sign, month_start, slash.sign, day_start, # you can change the year just here
                                                                                                      space, &quot;AND&quot;, space, 
                                                                                                      &quot;dateparution&quot;, less.than.or.equal.to.sign, &quot;2020&quot;, slash.sign, month_stop, slash.sign, day_stop))$content))$item$value} # you can change the year just here

# ============= List of all the web id =================
rm(list_webid)
list_webid=c()
for(t in 1:length(periods)-1){list_webid&lt;-c(list_webid,get_webid(unlist(strsplit(periods[t], split=&quot;-&quot;))[1], unlist(strsplit(periods[t], split=&quot;-&quot;))[2],
                                                                 unlist(strsplit(periods[t+1], split=&quot;-&quot;))[1],unlist(strsplit(periods[t+1], split=&quot;-&quot;))[2]))}

#=======================================================
# =========GET the award notices based on the web id ===
#=======================================================

output.dir = &quot;~/BOAMP-tender-data-2020&quot;
dir.create(output.dir, recursive=FALSE, showWarnings=FALSE)
for(i in 1:length(list_webid)){
api.output.dir = file.path(output.dir,list_webid[i])
http.request = 
  paste0(&quot;http://api.dila.fr/opendata/api-boamp/annonces/v230/&quot;,list_webid[i])
r = GET(http.request, add_headers(Accept = &quot;application/json&quot;))
bin &lt;- content(r, &quot;raw&quot;)
writeBin(bin, file.path(paste0(api.output.dir,&quot;.json&quot;)))}

which(list_webid==&quot;20-46396&quot;)
which(list_webid==&quot;20-134546&quot;)
which(list_webid==&quot;20-159402&quot;)

# ========================================
# =========== generate the dataframe ====
# =======================================

output.dir = &quot;~/BOAMP-tender-data-2020&quot;

list.files(output.dir)
list_temp &lt;-c(list.files(output.dir))
list_webid&lt;-substr(list_temp, 1, nchar(list_temp)-5)
list_webid_unique &lt;-unique(list_webid)

make_df&lt;-function(rank){fromJSON(paste0(file.path(output.dir,list_webid_unique[rank]),&quot;.json&quot;))}
id=c()
sociaux=c()
envir=c()
adjudicateurnuts=c()
denomination_ach=c()
adresse_ach=c()
codepostal_ach=c()
ville_ach=c()
typepouvoiradjudicateur=c()
nbr_lots=c()
typeprocedure=c()
typeorganisme=c()
rm(i)

for(i in 1:length(list_webid_unique)){test=make_df(i)
  id[i]&lt;-ifelse(is.null(test$gestion$reference$idweb), NA, test$gestion$reference$idweb)
  denomination_ach[i]&lt;-ifelse(is.null(test$donnees$identite$denomination), NA,test$donnees$identite$denomination)
  adresse_ach[i]&lt;-ifelse(is.null(test$donnees$identite$adresse), NA,test$donnees$identite$adresse)
  codepostal_ach[i]&lt;-ifelse(is.null(test$donnees$identite$cp), NA,test$donnees$identite$cp)
  ville_ach[i]&lt;-ifelse(is.null(test$donnees$identite$ville), NA,test$donnees$identite$ville)
  sociaux[i]&lt;-ifelse(is.null(test$gestion$indexation$criteressociauxenv$sociaux),0,1)
  envir[i]&lt;-ifelse(is.null(test$gestion$indexation$criteressociauxenv$environnementaux),0,1)
  adjudicateurnuts[i]&lt;-ifelse(is.null(test$donnees$identite$adjudicateurnuts), NA,test$donnees$identite$adjudicateurnuts)
  tryCatch(nbr_lots[i]&lt;-ifelse(is.na(test$donnees$objet$lots),NA,ifelse(nrow(as.data.frame(test$donnees$objet$lots$lot))==0,1,nrow(as.data.frame(test$donnees$objet$lots$lot)))), error = function(e) nbr_lots[i]&lt;-1)
  
  typepouvoiradjudicateur[i]&lt;-ifelse(is.null(test$donnees$typepouvoiradjudicateur),NA,
                                     ifelse(!is.null(test$donnees$typepouvoiradjudicateur$minautoritenationale),&quot;minautoritenationale&quot;,
                                            ifelse(!is.null(test$donnees$typepouvoiradjudicateur$agencenational), &quot;agencenational&quot;,
                                                   ifelse(!is.null(test$donnees$typepouvoiradjudicateur$autotriteregional), &quot;autoriteregional&quot;,
                                                          ifelse(!is.null(test$donnees$typepouvoiradjudicateur$agenceregional),&quot;agenceregionale&quot;,
                                                                 ifelse(!is.null(test$donnees$typepouvoiradjudicateur$orgdroitpublic),&quot;orgdroitpublic&quot;,
                                                                        ifelse(!is.null(test$donnees$typepouvoiradjudicateur$institutioneuropeenne),&quot;institutioneuropeenne&quot;,&quot;autre&quot;
)
))))))
typeprocedure[i]&lt;-ifelse(is.null(test$donnees$procedure$typeprocedure),NA,
                 ifelse(!is.null(test$donnees$procedure$typeprocedure$ouvert), &quot;ouvert&quot;,
                      ifelse(!is.null(test$donnees$procedure$typeprocedure$restreint), &quot;restreint&quot;,
                             ifelse(!is.null(test$donnees$procedure$typeprocedure$negocie), &quot;negocie&quot;,
                                  ifelse(!is.null(test$donnees$procedure$typeprocedure$procedureadapte), &quot;procedureadapte&quot;,
                                         ifelse(!is.null(test$donnees$procedure$typeprocedure$dialoguecompetitif), &quot;dialoguecompetitif&quot;,
                                                ifelse(!is.null(test$donnees$procedure$typeprocedure$partenariatinnovation), &quot;partenariatinnovation&quot;,NA
                                                
)))))))

typeorganisme[i]&lt;-ifelse(is.null(test$donnees$typeorganisme),NA,
                         ifelse(!is.null(test$donnees$typeorganisme$institutioneuropeenne), &quot;institutioneuropeenne&quot;,
                                ifelse(!is.null(test$donnees$typeorganisme$etat),&quot;etat&quot;,
                                                 ifelse(!is.null(test$donnees$typeorganisme$region),&quot;region&quot;,
                                                                 ifelse(!is.null(test$donnees$typeorganisme$departement),&quot;departement&quot;,
                                                                                 ifelse(!is.null(test$donnees$typeorganisme$commune),&quot;commune&quot;,
                                                                                                 ifelse(!is.null(test$donnees$typeorganisme$epn), &quot;epn&quot;,
                                                                                                        ifelse(!is.null(test$donnees$typeorganisme$ept), &quot;ept&quot;,
                                                                                                               ifelse(!is.null(test$donnees$typeorganisme$autre),&quot;autre&quot;,NA)))))))))
  }


df&lt;-cbind(id, denomination_ach,adresse_ach,codepostal_ach,ville_ach ,adjudicateurnuts,typepouvoiradjudicateur, typeorganisme  ,nbr_lots, typeprocedure, sociaux, envir)
df&lt;-as.data.frame(df)
df$sociaux &lt;-as.numeric(df$sociaux)
df$envir &lt;- as.numeric(df$envir)
summary(df)

#######################################
# DATABASE RELATIVE TO SELECTED SUPPLIERS 
########################################

suppl_denomination=c()
suppl_adresse=c()
suppl_cp=c()
suppl_ville=c()
suppl_codenuts=c()
suppl_nboffrerecu=c()
lot_cpv=c()
id=c()
k=1
for(i in 32536:length(list_webid_unique)){
  for(j in 1:ifelse(is.na(df[i,]$nbr_lots),1,df[i,]$nbr_lots)){running_case = make_df(i)
    suppl_denomination[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$denomination, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$denomination, error = function(e) NA),NA)
    suppl_adresse[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$adresse, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$adresse, error = function(e) NA),NA)
    suppl_cp[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$cp, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$cp, error = function(e) NA),NA)
    suppl_ville[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$ville, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$ville, error = function(e) NA),NA)
    suppl_codenuts[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$codenuts, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$codenuts, error = function(e) NA),NA)
    suppl_nboffrerecu[k]&lt;-ifelse(!is.null(tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$nboffrerecu, error = function(e) NA)),
                                  tryCatch(running_case$donnees$attribution$decision$titulaireandRENSEIGNEMENT[[j]][1,]$nboffrerecu, error = function(e) NA),NA)
    
    lot_cpv[k]&lt;-ifelse(!is.null(tryCatch(as.data.frame(running_case$donnees$objet$lots[1]$lot)$cpv[[j]]$principal, error = function(e) NA)),
                       tryCatch(as.data.frame(running_case$donnees$objet$lots[1]$lot)$cpv[[j]]$principal, error = function(e) NA),NA)
    
    id[k] &lt;- ifelse(is.null(running_case$gestion$reference$idweb), NA, running_case$gestion$reference$idweb)
    k=k+1
  }
}


suppl_df = cbind(id, suppl_denomination,suppl_adresse,suppl_ville,suppl_cp,suppl_codenuts,suppl_nboffrerecu, lot_cpv)
suppl_df&lt;-as.data.frame(suppl_df)

# ================================
# JOIN DATABASES
# ================================

BOAMP_df&lt;-left_join(suppl_df, df)

# ========================
# additionnal variables
# ========================

# suppress the un-allocated markets

BOAMP_df&lt;-BOAMP_df[which(!is.na(suppl_denomination)),]

# same department

BOAMP_df$local_dep &lt;-ifelse(str_sub(BOAMP_df$suppl_cp,1,2) ==str_sub(BOAMP_df$codepostal_ach,1,2),1,0)

# same NUTS

BOAMP_df$local_nuts &lt;-ifelse(BOAMP_df$suppl_codenuts ==BOAMP_df$adjudicateurnuts,1,0)
BOAMP_df$local_nuts4 &lt;-ifelse(str_sub(BOAMP_df$suppl_codenuts,1,4) ==str_sub(BOAMP_df$adjudicateurnuts,1,4),1,0)
BOAMP_df$local_nuts3 &lt;-ifelse(str_sub(BOAMP_df$suppl_codenuts,1,3) ==str_sub(BOAMP_df$adjudicateurnuts,1,3),1,0)


# ==============================
# GET THE DATA DIRECTLY FROM RDA
# ===============================

saveRDS(BOAMP_df, file=BOAMP_destfile)
}

BOAMP_df&lt;- readRDS(file=BOAMP_destfile)</code></pre>
<p>Afin de structurer ces données en une dataframe utilisable pour des traitements statistiques, un travail de récupération, structuration, nettoyage préalable est nécessaire. À l’issue de ce dernier, on obtient un tableau qui ressemble à cela :</p>
<pre class="r"><code>table&lt;-BOAMP_df[1:50,c(1:12)]

table%&gt;%
  datatable(extensions = &#39;Buttons&#39;,
            options = list(dom = &#39;Blfrtip&#39;,
                           buttons = c(&#39;copy&#39;, &#39;csv&#39;, &#39;excel&#39;, &#39;pdf&#39;, &#39;print&#39;),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,&quot;All&quot;))),rownames = FALSE)</code></pre>
<div id="htmlwidget-a4a9aa721065f3102c95" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a4a9aa721065f3102c95">{"x":{"filter":"none","extensions":["Buttons"],"data":[["16-94814","17-124275","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-134402","18-165119","18-165119","18-165119","18-165119","19-109359","19-109490","19-109490","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-110063","19-113900","19-113900","19-113900","19-114272","19-121843","19-125175","19-125175","19-125455","19-127292","19-127292","19-127292","19-127292","19-127292","19-127292","19-127386","19-129797","19-137277","19-138853","19-144706"],["ALCION/CITEOS Ingénierie Méditerranée","VIENNE MEDICAL","GIDEF SARL ","Association ab stratégie","Flore alternance","Association ab stratégie","Fotramege","Sarl ris'k","Mic formation","Mic formation","Mic formation","Caraïbes conseil formation (CARACOF)","Carïbes conseils formation (CARACOF)","ENEDIS","MARKET ONE","Market One ","CARAIB EDIPRINT (IMPRIMERIE ANTILLAISE)","OPEN MEDIA","L'ATELIERS DES COMPAGNONS","SEQUOIA","ETC AUDIOVISUEL","SARL DENJEAN","SOPREMA ENTREPRISES","SOTERLY","EIFFAGE CONSTRUCTION RHONE LOIRE","Rolando Poisson","Alliance Ecoconstruction","Groupement Etbs Denjean et ERTCM Industries","SARL Menuiserie Genevrier","PERRET SARL","SARL BVL ARCHITECTURE","A.D.T INTERNATIONAL","A.D.T INTERNATIONAL","A.D.T INTERNATIONAL","SBM TOSHIBA","CENTRE INTERNATIONAL DISTRIBUTION (CID)","CORRE SARL","RUNEO","EPIC SNCF MOBILITES","LA CROIX SIGNALISATION","INGENIA","SAR","SPME","COLAS","UNIVERS'EL","SEMADER","ENEDIS","CST  Commission supérieure technique de limage et du son","BOURBOUZE ET GRAINDORGE","SOC TAMO"],[null,"1 rue Louis Juttet",null,null,"Zi jarry","Route de gondeau","Les hauts de Californie espace dd",null,"Bât E4 - 2ème étage","Bât e4 2ème étage","Bât e4 - 2ème étage","Bât 3 - 1er étage","Bât 3 - 1er étage ","174, avenue de la République","30, rue neuve",null,"Bois quarré","Centre d'affaires agora - Zac de l'étang z'abricot","25, avenue Michelet",null,null,"11 Route d'Yzeron","3, rue Louis Lachenal - BP 223","Rue des Coquelicots","3, rue Hrant Dink","3, rue Raspail","8, rue Emile Zola","11 Route d'Yzeron","Avenue Benoît Fourneyron - Parc Beaunier","72 Avenue du Progrès","66 rue de Sèvres",null,null,null,null,"216, Route de Bayonne CS 17607",null,null,"9 rue Jean-Philippe Rameau",null,"5 Rue du Marais","103-105 Rue des Fontanots","7 Route de l'Ile Saint Julien","2 Impasse des Petits Marais","153 Rue André Bisiaux","Actiparc des Sables - 52 route des Sables - CS 21 008",null,"22/24 avenue de Saint-Ouen ",null,"44 route de la sirole"],["Marseille","Champagne au Mont d'Or","Fort de france","Lamentin","Baie-mahau","Lamentin","Lamentin","Fort de france","Fort de france ","Fort de france","Lamentin","Sainte-marie","Sainte-marie","La Madeleine","TROIS-ILETS","TROIS-ILETS","LAMENTIN","FORT DE FRANCE","Saint ouen","Epone","Ivry sur seine","Saint Martin en Haut","GENAC CEDEX","Mions","LYON","Saint Fons","DECINES","Saint Martin en Haut","ANDREZIEUX BOUTHEON","Chassieu","PARIS","CHATEAUNEUF LES MARTIGUES","CHATEAUNEUF LES MARTIGUES","CHATEAUNEUF LES MARTIGUES","Le Lamentin","TOULOUSE CEDEX 3","TAMPON","Saint-Denis","Saint-Denis","Saint Herblain","Montreuil-sous-bois","Nanterre","Bonneuil sur Marne","Gennevilliers","Maxeville","Etang-Salé","LAVAL","PARIS","NANTES","NICE"],["13015","69410","972","97232","97122","97232","97232","97202","97200","97200","97200","97230","97230","59110","97228","97228","97232","97200","93400",null,null,"69850","69744","69780","69285","69190","69150","69850","42160","69680","75007","13220","13220","13220",null,"31076",null,null,"93200","44801","93100","92022","94380","92230","54320","97424",null,"75018",null,"06100"],["FRL",null,"FRY20","FRY20","FRY1","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRE11","FRY20","FRY20","FRY20","FRY20",null,"FR","FR","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FR","FR","FR","FR","FRY20","FR","FRY4","FRY4","FR106","FRG01","FR106","FR105","FR107","FR105","FRF3","FRY40","FRG03","FR101","FRG0","FRL03"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["34993000",null,"80530000","80530000","80530000","80530000","80530000","80530000","80530000","80530000","80530000","80530000","80530000","65300000","79800000","79800000","79800000","79800000",null,"45212313","32322000","45112500","45262311","45261100","45261420","45421100","45261220","45262650","45223110","45421000","71200000","79530000","79530000","79530000","30121100","22200000","45500000","45500000","60200000","34992000","34928400","34922000","44113320","44113320","34927100","45111290","65310000","71630000","71000000","33100000"],["Ville de Grimaud","CENTRE HOSPITALIER REG DE MARSEILLE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","Commune d'Hautmont","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COLLECTIVITE TERRITORIALE MARTINIQUE","COMSOPGN - COSIL","C.C de la Grande Vallée de la Marne","C.C de la Grande Vallée de la Marne","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","Métropole de Lyon","COMMUNAUTE COMMUNES HUISNE SARTHOISE","Tunnel Euralpin Lyon Turin SAS","Tunnel Euralpin Lyon Turin SAS","Tunnel Euralpin Lyon Turin SAS","CHU de Martinique","COLLECTIVITE TERRITORIALE MARTINIQUE","Commune du Tampon","Commune du Tampon","Ville de Paris","Mairie d'Alfortville","Mairie d'Alfortville","Mairie d'Alfortville","Mairie d'Alfortville","Mairie d'Alfortville","Mairie d'Alfortville","Commune de Saint Leu","TERRITOIRE D'ENERGIE MAYENNE","Centre national du cinéma","CIF COOPERATIVE","METROPOLE D AIX MARSEILLE PROVENCE"],["rue de la mairie","Direction des Achats80 rue Brochier","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Rue Gaston Defferre CS 30137","Place Charles de Gaulle","rue Gaston Defferre - cs 30137","rue Gaston Defferre - cs 30137","rue Gaston Defferre - cs 30137","rue Gaston Defferre - cs 30137","4 avenue Busteau","Place Henri Martin","Place Henri Martin","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","Délégation générale aux RessourcesDirection du Patrimoine et des Moyens GénérauxUnité Procédure, achats, marchés20 rue du LacCS 33569","25 rue Jean Courtois - BP 50061","Savoie Technolac - Bâtiment \"Homère\" - 13 allée du Lac de Constance - CS 90281","Savoie Technolac - Bâtiment \"Homère\" - 13 allée du Lac de Constance - CS 90281","Savoie Technolac - Bâtiment \"Homère\" - 13 allée du Lac de Constance - CS 90281","CS 90632 - Département Achats","rue Gaston Defferre CS 30137","256, Rue Hubert Delisle","256, Rue Hubert Delisle","Direction des Finances et des Achats - Sous-direction des Achats CSP 2 - 7 avenue de la Porte d'Ivry","Place François MITTERRAND","Place François MITTERRAND","Place François MITTERRAND","Place François MITTERRAND","Place François MITTERRAND","Place François MITTERRAND","58, rue du Général Lambert","Parc Technopolis Rue Louis de Broglie","291 boulevard Raspail","10 RUE DE BEL AIR CS 53205","58 bd Charles Livon"],["83310","13005","97201","97201","97201","97201","97201","97201","97201","97201","97201","97201","97201","59330","97201","97201","97201","97201","94700","51160","51160","69505","69505","69505","69505","69505","69505","69505","69505","69505","72403","73375","73375","73375","97261","97200","97430","97430","75013","94142","94142","94142","94142","94142","94142","97436",null,"75014","44032","13007"],["GRIMAUD","Marseille","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","HAUTMONT","Fort-de-france","Fort-de-france","Fort-de-france","Fort-de-france","Maisons-alfort","AY CHAMPAGNE","AY CHAMPAGNE","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","LA FERTE BERNARD","Le Bourget du Lac","Le Bourget du Lac","Le Bourget du Lac","Fort-de-France Cedex","Fort-de-france","LE TAMPON","LE TAMPON","Paris","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Saint-Leu","CHANGE","Paris","NANTES CEDEX 1","Marseille"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>id<\/th>\n      <th>suppl_denomination<\/th>\n      <th>suppl_adresse<\/th>\n      <th>suppl_ville<\/th>\n      <th>suppl_cp<\/th>\n      <th>suppl_codenuts<\/th>\n      <th>suppl_nboffrerecu<\/th>\n      <th>lot_cpv<\/th>\n      <th>denomination_ach<\/th>\n      <th>adresse_ach<\/th>\n      <th>codepostal_ach<\/th>\n      <th>ville_ach<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Blfrtip","buttons":["copy","csv","excel","pdf","print"],"lengthMenu":[[10,25,50,-1],["10","25","50","All"]],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>table2&lt;-BOAMP_df[1:50,c(1,12:23)]

table2%&gt;%
  datatable(extensions = &#39;Buttons&#39;,
            options = list(dom = &#39;Blfrtip&#39;,
                           buttons = c(&#39;copy&#39;, &#39;csv&#39;, &#39;excel&#39;, &#39;pdf&#39;, &#39;print&#39;),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,&quot;All&quot;))),rownames = FALSE)</code></pre>
<div id="htmlwidget-dda7d1f7e57998398032" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dda7d1f7e57998398032">{"x":{"filter":"none","extensions":["Buttons"],"data":[["16-94814","17-124275","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-116367","18-134402","18-165119","18-165119","18-165119","18-165119","19-109359","19-109490","19-109490","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-109992","19-110063","19-113900","19-113900","19-113900","19-114272","19-121843","19-125175","19-125175","19-125455","19-127292","19-127292","19-127292","19-127292","19-127292","19-127292","19-127386","19-129797","19-137277","19-138853","19-144706"],["GRIMAUD","Marseille","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","FORT-DE-FRANCE","HAUTMONT","Fort-de-france","Fort-de-france","Fort-de-france","Fort-de-france","Maisons-alfort","AY CHAMPAGNE","AY CHAMPAGNE","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","Lyon Cedex 03","LA FERTE BERNARD","Le Bourget du Lac","Le Bourget du Lac","Le Bourget du Lac","Fort-de-France Cedex","Fort-de-france","LE TAMPON","LE TAMPON","Paris","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Alfortville cedex","Saint-Leu","CHANGE","Paris","NANTES CEDEX 1","Marseille"],["FR",null,"FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRY20","FRE11","FRY20","FRY20","FRY20","FRY20",null,"FR","FR","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRK26","FRG04","FRK27","FRK27","FRK27","FRY2","FR","FRY4","FRY4","FR101","FR107","FR107","FR107","FR107","FR107","FR107","FRY40","FRG03","FR101","FR","FRL04"],["autoriteregional",null,"autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autre","minautoritenationale","minautoritenationale","minautoritenationale","minautoritenationale",null,"autoriteregional","autoriteregional","autre","autre","autre","autre","autre","autre","autre","autre","autre","autoriteregional",null,null,null,"orgdroitpublic","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autoriteregional","autre",null,"orgdroitpublic","autre","autre"],[null,"autre",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"etat",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["1",null,"16","16","16","16","16","16","16","16","16","16","16","1","5","5","5","5",null,"6","6","9","9","9","9","9","9","9","9","9","1","3","3","3","2","3","3","3","1","6","6","6","6","6","6","1","1","1","1","4"],["ouvert","negocie","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert",null,"ouvert","ouvert","ouvert","ouvert","restreint","negocie","negocie","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","restreint","negocie","negocie","negocie","ouvert","ouvert","ouvert","ouvert","negocie","ouvert","ouvert","ouvert","ouvert","ouvert","ouvert","negocie",null,"ouvert","ouvert","ouvert"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,null,null,1,1,1,1,1,1,1,0,1,0,0,0,0,null,0,null,null,0,0,0,0,1,0,0,1,null,1,null,0],[0,null,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,1,1,1,0,0],[0,null,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1],[0,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>id<\/th>\n      <th>ville_ach<\/th>\n      <th>adjudicateurnuts<\/th>\n      <th>typepouvoiradjudicateur<\/th>\n      <th>typeorganisme<\/th>\n      <th>nbr_lots<\/th>\n      <th>typeprocedure<\/th>\n      <th>sociaux<\/th>\n      <th>envir<\/th>\n      <th>local_dep<\/th>\n      <th>local_nuts<\/th>\n      <th>local_nuts4<\/th>\n      <th>local_nuts3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Blfrtip","buttons":["copy","csv","excel","pdf","print"],"lengthMenu":[[10,25,50,-1],["10","25","50","All"]],"columnDefs":[{"className":"dt-right","targets":[7,8,9,10,11,12]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Cette base inclue des variables propre au traitement - sociaux (0/1) en fonction de la présence ou non de clause sociale dans le marché. - envir (0/1) en fonction de la présence ou non de clause environnementale dans le marché (attention, comme pour la précédente, la présence de clause s’entend à l’échelle du marché et donc pas nécessairement du lot considéré, ces informations n’étant pas disponibles dans les données BOAMP) - local_dep (0/1) indique si un marché est conclu auprès d’une entreprise localisée dans le même département que l’acheteur - à différentes échelles, on retrouve la même logique pour les indicateurs local_NUTS, local_NUTS4 et local_NUTS3 (NUTS à 5 caractères, 4 caractères et 3 caractères, ce qui correspond à 3 niveaux de proximité géographique).</p>
<p>Cette base est aussi très dépendante de la qualité des données saisies en amont. Ainsi en est-il des champs non renseignés ou des données saisies dans un format impropre.</p>
</div>
<div id="analyse-des-données-2020" class="section level1">
<h1>Analyse des données 2020</h1>
<pre class="r"><code>summary(BOAMP_df$local_dep)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   0.000   0.000   0.000   0.381   1.000   1.000   16995</code></pre>
<pre class="r"><code>table(str_sub(BOAMP_df$suppl_codenuts,1,2), str_sub(BOAMP_df$adjudicateurnuts,1,2))[,4]</code></pre>
<pre><code>##    00    AL    AT    BE    CH    CZ    DE    DK    EL    ES    FI    FR    IE 
##    18     2     5    57    27     1    55     5     2    22     1 49594     1 
##    IT    LT    LU    MT    NL    NO    PL    PT    SK    UK 
##    34     1    10     1    35     1     6     4     1    15</code></pre>
<p>Sur l’année 2020, la base permet d’identifier 69723 contrats entre acheteurs publics et fournisseurs. Parmis eux, 13.2 % intègrent des clauses environnementales, contre 6.33 % de clauses sociales.</p>
<pre class="r"><code>mydata&lt;-aggregate(BOAMP_df[which(str_length(BOAMP_df$adjudicateurnuts)==5),19], by=list(BOAMP_df[which(str_length(BOAMP_df$adjudicateurnuts)==5),]$adjudicateurnuts), FUN=mean)

mydata%&gt;%
  datatable(extensions = &#39;Buttons&#39;,
            options = list(dom = &#39;Blfrtip&#39;,
                           buttons = c(&#39;copy&#39;, &#39;csv&#39;, &#39;excel&#39;, &#39;pdf&#39;, &#39;print&#39;),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,&quot;All&quot;))),rownames = FALSE)</code></pre>
<div id="htmlwidget-a4a9aa721065f3102c95" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a4a9aa721065f3102c95">{"x":{"filter":"none","extensions":["Buttons"],"data":[["DE712","ES511","FR101","FR102","FR103","FR104","FR105","FR106","FR107","FR108","FR212","FR222","FR232","FR244","FR246","FR252","FR301","FR302","FR414","FR421","FR431","FR433","FR511","FR512","FR522","FR523","FR532","FR534","FR613","FR623","FR711","FR712","FR714","FR716","FR813","FR823","FR824","FR825","FR940","FRB01","FRB02","FRB03","FRB04","FRB05","FRB06","FRC11","FRC12","FRC13","FRC14","FRC21","FRC22","FRC23","FRC24","FRD11","FRD12","FRD13","FRD21","FRD22","FRE11","FRE12","FRE21","FRE22","FRE23","FRF11","FRF12","FRF21","FRF22","FRF23","FRF24","FRF31","FRF32","FRF33","FRF34","FRG01","FRG02","FRG03","FRG04","FRG05","FRH01","FRH02","FRH03","FRH04","FRI11","FRI12","FRI13","FRI14","FRI15","FRI21","FRI22","FRI23","FRI31","FRI32","FRI33","FRI34","FRJ11","FRJ12","FRJ13","FRJ14","FRJ15","FRJ21","FRJ22","FRJ23","FRJ24","FRJ25","FRJ26","FRJ27","FRJ28","FRK11","FRK12","FRK13","FRK14","FRK21","FRK22","FRK23","FRK24","FRK25","FRK26","FRK27","FRK28","FRL01","FRL02","FRL03","FRL04","FRL05","FRL06","FRM01","FRM02","FRY10","FRY20","FRY30","FRY40","FRY50","FRZZZ"],[0,0,0.147556845670053,0.171779141104294,0.145631067961165,0.16382252559727,0.217252396166134,0.201349831271091,0.201219512195122,0.156043956043956,0,0.12,0,0,0,0,0.0895522388059701,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0.5,0,0,0.12621359223301,0.0688073394495413,0.115384615384615,0,0.1484375,0.222680412371134,0.377224199288256,0.232558139534884,0.29287598944591,0.048,0.0728155339805825,0.0806451612903226,0.0784313725490196,0.291970802919708,0.0365111561866126,0.106583072100313,0,0.225210084033613,0.170533642691415,0.135718341851221,0.140243902439024,0.0338983050847458,0.174008810572687,0.215311004784689,0.176949941792782,0.0724299065420561,0.0173913043478261,0.0065359477124183,0.133333333333333,0.0240963855421687,0.0769230769230769,0.722943722943723,0.26865671641791,0.035,0.0673886883273165,0.099290780141844,0.0151515151515152,0.0827067669172932,0.164728682170543,0.0688524590163934,0.254166666666667,0.265758091993186,0.0740740740740741,0.00975609756097561,0.132920110192837,0.126126126126126,0.179347826086957,0.0671140939597315,0.0510204081632653,0,0.0989010989010989,0.0168067226890756,0.150485436893204,0.116591928251121,0.122562674094708,0,0.0221606648199446,0.051685393258427,0.128712871287129,0.224890829694323,0.054726368159204,0.00549450549450549,0.166086956521739,0,0.00869565217391304,0.0411522633744856,0.232558139534884,0.00881057268722467,0.146496815286624,0,0,0.18978102189781,0.0498338870431894,0,0.0639097744360902,0.176678445229682,0.120287253141831,0.214689265536723,0.0524642289348172,0.0891938250428816,0.148148148148148,0.235294117647059,0.158106747230614,0.151724137931034,0.126666666666667,0.268398268398268,0.0065359477124183,0.0898203592814371,0.294642857142857,0.0900473933649289,0.134146341463415,0.137853107344633,0.11304347826087,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Group.1<\/th>\n      <th>x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Blfrtip","buttons":["copy","csv","excel","pdf","print"],"lengthMenu":[[10,25,50,-1],["10","25","50","All"]],"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>On peut également s’amuser à identifier les marchés attribués à des entreprises en dehors du territoire national :</p>
<pre class="r"><code># Maps

data(nuts2006)
library(sp)
library(sf)
region&lt;-as.data.frame(table(str_sub(BOAMP_df[which(str_sub(BOAMP_df$suppl_codenuts,1,2)!=&quot;FR&quot;),]$suppl_codenuts,1,2)))
names(region)[names(region) == &#39;Var1&#39;] &lt;- &#39;id&#39;

choroLayer(spdf = nuts0.spdf, df = region, var = &quot;Freq&quot;, legend.pos = &quot;topright&quot;, legend.title.txt = &quot;Nb de contrats&quot;)</code></pre>
<p><img src="live_from_BOAMP_files/figure-html/maps1-1.png" width="672" /></p>
<pre class="r"><code># Titles, legend, sources
#layoutLayer(title = &quot;L&#39;achat public à l&#39;international&quot;,
 #           author = &quot;carto : PH Morand&quot;,
  #          sources = &quot;https://www.data.gouv.fr/fr/datasets/api-boamp-beta/, 2021&quot;,
   #         scale = NULL,
    #        south = TRUE)</code></pre>
<p>Ces derniers restent cependant très largemet minoritaires. On observe ainsi en 2020 305 marchés attribués à une entreprise hors du territoire national, pour un total de 69723 contrats.</p>
<p>L’usage des clauses environnementales s’avère très hétérogène à l’échelle territoriale :</p>
<pre class="r"><code>boamp_test&lt;-BOAMP_df

NUTS_FRANCE_CORRESPONDANCES &lt;- read.delim(str_c(data_dir, &quot;/NUTS_FRANCE_CORRESPONDANCES.txt&quot;), header=FALSE)


boamp_test&lt;-left_join(boamp_test, NUTS_FRANCE_CORRESPONDANCES, by=c(&quot;adjudicateurnuts&quot; = &quot;V4&quot;))
boamp_test$adjudicateurnuts&lt;-ifelse(!is.na(boamp_test$V3),boamp_test$V3,boamp_test$adjudicateurnuts )
data(nuts2006)

graph_data&lt;-aggregate(boamp_test[which(str_length(boamp_test$adjudicateurnuts)==5),]$envir*100,by=list(boamp_test[which(str_length(boamp_test$adjudicateurnuts)==5),]$adjudicateurnuts), FUN=mean)
names(graph_data)[names(graph_data) == &#39;Group.1&#39;] &lt;- &#39;id&#39;
graph_data &lt;-as.data.frame(graph_data)
graph_data&lt;-graph_data[which(str_sub(graph_data$id,1,2)==&quot;FR&quot;),]
choroLayer(spdf = nuts3.spdf, df = graph_data, var = &quot;x&quot;, legend.title.txt = &quot;% clause envir.&quot;, method = &quot;quantile&quot;, nclass = 5,
           col = carto.pal(pal1 = &quot;green.pal&quot;, n1 = 5))</code></pre>
<p><img src="live_from_BOAMP_files/figure-html/clauses_envi-1.png" width="672" /></p>
<p>Il en est de même des clauses sociales :</p>
<pre class="r"><code>graph_data&lt;-aggregate(boamp_test[which(str_length(boamp_test$adjudicateurnuts)==5),]$sociaux*100,by=list(boamp_test[which(str_length(boamp_test$adjudicateurnuts)==5),]$adjudicateurnuts), FUN=mean)
names(graph_data)[names(graph_data) == &#39;Group.1&#39;] &lt;- &#39;id&#39;
graph_data &lt;-as.data.frame(graph_data)
graph_data&lt;-graph_data[which(str_sub(graph_data$id,1,2)==&quot;FR&quot;),]
choroLayer(spdf = nuts3.spdf, df = graph_data, var = &quot;x&quot;, legend.title.txt = &quot;% clause soc.&quot;, method = &quot;quantile&quot;, nclass = 5,
           col = carto.pal(pal1 = &quot;red.pal&quot;, n1 = 5),
           border = &quot;grey40&quot;,)</code></pre>
<p><img src="live_from_BOAMP_files/figure-html/clauses_soc-1.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
