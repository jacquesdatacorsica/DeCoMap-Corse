---
title: "Live from Tender Electronic Daily Database"
author: "Pierre-Henri Morand"
date: "date: `r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

version:  last update `r Sys.Date()`

# Presentation of the database

## Main characteristics

- The data comes from public procurement standard forms, which are filled in by
contracting bodies and sent as notices for publication to TED. Most of the variables in the data directly correspond to the fields in the forms.

- TED - Contract award notices 2010-2019. It is a merged file for the analysis across the years.

- TED data has multiple levels. Contract awards (CAs), which is the fifth section of a CAN standard form. Each CAN has one or more CAs. ID_award_ca is an ID of a CA.

- These levels serve different purposes. To give an example, a CAN generally informs on the result of the procurement (“The ministry has bought furniture”); and the three individual CAs, nested within the CAN, inform about the specific detail (“The ministry has bought a chair from company A”; “The ministry has bought a table from company B”; “The ministry has bought a cupboard from company B”). 

## Downloading the data

The latest database can be downloaded directly [here](https://data.europa.eu/euodp/repository/ec/dg-grow/mapps/TED%202020/Export_OpenDataCAN_from2010to2019.csv)

```{r, echo=FALSE}
#importing useful library

library(tidyverse)
library(banR)
library(jsonlite)
library(magrittr)
library(data.tree)
library(geosphere)
library(sf)
library(cartography)
library(stringr)

#creating the data repository
data_dir <- 'data'
if (!dir.exists(data_dir)) {
  dir.create(data_dir)
}

# downloading the DECP JSON file from the remote data.europa.eu site.
TED_url <- "https://data.europa.eu/euodp/repository/ec/dg-grow/mapps/TED%202020/Export_OpenDataCAN_from2010to2019.csv"
TED_destfile <-  str_c(data_dir, "/Export_OpenDataCAN_from2010to2019.csv")
if (!file.exists(TED_destfile)) {
 download.file(TED_url, TED_destfile)
}

# creating the dataframe
TED<- read.csv(TED_destfile)
```
# Some data to work up the appetite!

The database represents `r length(TED$ID_NOTICE_CAN)` contrats awarded between 2010 and 2019. Here is the number of contracts by buyers country and by year :
```{r, echo=FALSE}
library(DT)
datatable(table(TED$ISO_COUNTRY_CODE, TED$YEAR), colnames = c("Country code", "Year", "Nb of Contracts"))
```
France (as well as Poland) accounts for a large share of the data available under TED.
```{r, echo=FALSE}
barplot(table(TED[which(TED$ISO_COUNTRY_CODE=="FR" |TED$ISO_COUNTRY_CODE=="DE"|TED$ISO_COUNTRY_CODE=="IT"|TED$ISO_COUNTRY_CODE=="UK"|TED$ISO_COUNTRY_CODE=="PL"),]$YEAR, TED[which(TED$ISO_COUNTRY_CODE=="FR" |TED$ISO_COUNTRY_CODE=="DE"|TED$ISO_COUNTRY_CODE=="IT"|TED$ISO_COUNTRY_CODE=="UK"|TED$ISO_COUNTRY_CODE=="PL"),]$ISO_COUNTRY_CODE), legend.text = TRUE, main="cumulative nb of contracts", ylab="Nb", xlab="Country")
```

